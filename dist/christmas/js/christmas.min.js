/*! web - christmas - v1.0.0 - 2015-03-06 */
function randomRange(a,b){return Math.random()*(b-a)+a}function createSnow(){container=document.createElement("div"),$("#page").append($(container)),$(container).addClass("snowFall"),camera=new THREE.PerspectiveCamera(75,SCREEN_WIDTH/SCREEN_HEIGHT,1,1e4),camera.position.z=1e3,scene=new THREE.Scene,scene.add(camera),renderer=new THREE.CanvasRenderer,renderer.setSize(SCREEN_WIDTH,SCREEN_HEIGHT);for(var a=new THREE.ParticleBasicMaterial({map:new THREE.Texture(particleImage)}),b=0;500>b;b++)particle=new Particle3D(a),particle.position.x=2e3*Math.random()-1e3,particle.position.y=2e3*Math.random()-1e3,particle.position.z=2e3*Math.random()-1e3,particle.scale.x=particle.scale.y=1.4,scene.add(particle),particles.push(particle);container.appendChild(renderer.domElement),setInterval(loop,50)}function loop(){for(var i=0;i<particles.length;i++){var particle=particles[i];with(particle.updatePhysics(),particle.position)y<-1e3&&(y+=2e3),x>1e3?x-=2e3:x<-1e3&&(x+=2e3),z>1e3?z-=2e3:z<-1e3&&(z+=2e3)}camera.position.x+=.05*(mouseX-camera.position.x),camera.position.y+=.05*(-mouseY-camera.position.y),camera.lookAt(scene.position),renderer.render(scene,camera)}$(function(){$(".pack").css("minHeight",$(window).height()),$(".giftevent .view").on("click",function(){var a=$(this).attr("data-val");if($(".codetext").hide(),$(".prz-ico").attr("class","prz-ico").addClass("prz-gift"+a),$(".giftshow .name").html($(this).siblings(".przname").val()),4==a||5==a)return $(".giftshow .text").hide(),$("#overlay").show(),!1;var b=$(this).siblings(".general").text();if($(".codetext .code").text(""),b)$(".generalc .code").text(b),$(".generalc, #overlay").show();else{var c=$(this).siblings(".appcode").text(),d=$(this).siblings(".ipacode").text();$(".appc .code").text(c),$(".ipac .code").text(d),$(".appc, .ipac, #overlay").show()}}),$(".giftshow .confirm, .giftclose").on("click",function(){$("#overlay").hide()}),$(".popup .confirm").on("click",function(){$("#overlay").hide(),$(".creditsleft .cred").text()>0&&("确定"==$(".popup-inner .confirm").text()?$("#overlay").hide():$(".slotbtn").trigger("click"))})}),$(function(){$(".lot").css("minHeight",$(window).height()),$(window).resize(function(){$(".lot").css("minHeight",$(window).height())});var a=!1;$(".giftshow .confirm, .giftclose").on("click",function(){$("#overlay").hide()}),$(".popup .confirm").on("click",function(){$("#overlay").hide(),$(".creditsleft .cred").text()>0&&("确定"==$(".popup-inner .confirm").text()?$("#overlay").hide():(a=!0,$(".slotbtn").trigger("click")))});var b=!0;$("#slotbtn").click(function(){function c(a,b){switch(a[0].id){case"machine1":$("#machine1Result").text("Index: "+b.index);break;case"machine2":$("#machine2Result").text("Index: "+b.index);break;case"machine3":$("#machine3Result").text("Index: "+b.index)}}if(b){b=!1;var d={stat:-1,result:[1,3,8],prizeCode:"A003",prizeName:"",creditsleft:180,timesleft:0,prizeTotalCount:3,tips:"很遗憾",creditsConsume:20,creditsTips:"今天赠送的抽奖机会已用完<br>花20积分再来一次吗？"};if(!d.timesleft&&!a)return $(".popup .tipstxt").html(d.creditsTips),$("#overlay").show(),b=!0,d.creditsleft<d.creditsConsume?("确定"==$(".popup-inner .confirm").text()&&$("#overlay").hide(),$(".popup .tipstxt").html("本次抽奖需要消耗"+d.creditsConsume+"积分<br>快去赚积分吧~"),$(".popup-inner .confirm").text("确定"),$("#overlay").show(),b=!0,!1):!1;d.prizeTotalCount||$(".lot-pack").html('<img class="lot-btm-img" src="images/backpack_small.png" alt="我的背包">');var e=$("#machine1").slotMachine({active:0,delay:500,stopIndex:d.result[0]}),f=$("#machine2").slotMachine({active:1,delay:500,stopIndex:d.result[1]}),g=$("#machine3").slotMachine({active:2,delay:500,stopIndex:d.result[2]});e.shuffle(3,c),setTimeout(function(){f.shuffle(3,c)},500),setTimeout(function(){g.shuffle(3,c)},1e3),$(".creditsleft .cred").html(d.creditsleft),$(".timesleft").html(d.timesleft),setTimeout(function(){-1==d.stat?($(".stat").hide(),$(".stat-failure").show()):0==d.stat?($("#prizename").html(d.prizeName),$(".stat").hide(),$(".stat-success").show()):(alert(d.tips),$(".stat").hide(),$(".stat-default").show()),b=!0,a=!1},3e3)}})}),Particle3D=function(a){THREE.Particle.call(this,a),this.velocity=new THREE.Vector3(0,-8,0),this.velocity.rotateX(randomRange(-45,45)),this.velocity.rotateY(randomRange(0,360)),this.gravity=new THREE.Vector3(0,0,0),this.drag=1},Particle3D.prototype=new THREE.Particle,Particle3D.prototype.constructor=Particle3D,Particle3D.prototype.updatePhysics=function(){this.velocity.multiplyScalar(this.drag),this.velocity.addSelf(this.gravity),this.position.addSelf(this.velocity)};var TO_RADIANS=Math.PI/180;THREE.Vector3.prototype.rotateY=function(a){cosRY=Math.cos(a*TO_RADIANS),sinRY=Math.sin(a*TO_RADIANS);var b=this.z,c=this.x;this.x=c*cosRY+b*sinRY,this.z=c*-sinRY+b*cosRY},THREE.Vector3.prototype.rotateX=function(a){cosRY=Math.cos(a*TO_RADIANS),sinRY=Math.sin(a*TO_RADIANS);var b=this.z,c=this.y;this.y=c*cosRY+b*sinRY,this.z=c*-sinRY+b*cosRY},THREE.Vector3.prototype.rotateZ=function(a){cosRY=Math.cos(a*TO_RADIANS),sinRY=Math.sin(a*TO_RADIANS);var b=this.x,c=this.y;this.y=c*cosRY+b*sinRY,this.x=c*-sinRY+b*cosRY};var SCREEN_WIDTH=window.innerWidth,SCREEN_HEIGHT=parseInt(94*window.innerWidth/75)+30,container,particle,camera,scene,renderer,mouseX=0,mouseY=0,windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,particles=[],particleImage=new Image;particleImage.src="images/snow.png",$(document).ready(function(){particleImage.onload=function(){createSnow()}});